{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Earth's Freshwater & Biological Water Distribution",
  "data": { "url": "water_cleaned.csv" },

  "params": [
    {
      "name": "viewFilter",
      "value": "FreshwaterOnly",
      "bind": {
        "input": "select",
        "options": ["FreshwaterOnly", "FreshwaterAndBiological"],
        "labels": ["Freshwater Only", "Freshwater + Biological"]
      }
    },
    {
      "name": "scaleType",
      "value": "linear",
      "bind": {
        "input": "select",
        "options": ["linear", "log"],
        "labels": ["Linear Scale", "Log Scale"]
      }
    },
    {
      "name": "highlight",
      "select": {"type": "point"},
      "bind": "legend"
    }
  ],

  "vconcat": [
    {
      "hconcat": [
        {
          "title": "Horizontal Bar Chart — Freshwater & Biological Water",
          "hconcat": [
            {
              "transform": [
                {
                  "filter":
                  "viewFilter === 'FreshwaterOnly' ? datum.CategoryGroup === 'Fresh Water' : true"
                },
                { "filter": "scaleType === 'linear'" }
              ],
              "mark": "bar",
              "encoding": {
                "y": {
                  "field": "Category",
                  "type": "nominal",
                  "sort": "-x"
                },
                "x": {
                  "field": "Volume_km3",
                  "type": "quantitative",
                  "scale": { "type": "linear" },
                  "title": "Volume (km³)"
                },
                "color": { "field": "CategoryGroup" },
                "opacity": {
                  "condition": {"param": "highlight", "value": 1},
                  "value": 0.4
                },
                "tooltip": [
                  {"field": "Category"},
                  {"field": "Volume_km3"},
                  {"field": "Percent_Global_Freshwater"}
                ]
              }
            },
            {
              "transform": [
                {
                  "filter":
                  "viewFilter === 'FreshwaterOnly' ? datum.CategoryGroup === 'Fresh Water' : true"
                },
                { "filter": "scaleType === 'log'" }
              ],
              "mark": "bar",
              "encoding": {
                "y": {
                  "field": "Category",
                  "type": "nominal",
                  "sort": "-x"
                },
                "x": {
                  "field": "Volume_km3",
                  "type": "quantitative",
                  "scale": { "type": "log" },
                  "title": "Volume (km³)"
                },
                "color": { "field": "CategoryGroup" },
                "opacity": {
                  "condition": {"param": "highlight", "value": 1},
                  "value": 0.4
                }
              }
            }
          ]
        }
      ]
    },

    {
      "title": "Bubble Chart — Freshwater vs Biological Water",
      "height": 300,
      "mark": {"type": "circle", "opacity": 0.75},
      "transform": [
        {
          "filter": "viewFilter === 'FreshwaterOnly' ? datum.CategoryGroup === 'Fresh Water' : true"
        }
      ],
      "encoding": {
        "x": {
          "field": "Category",
          "type": "nominal",
          "axis": {"labelAngle": -40}
        },
        "y": {"value": 0},
        "size": {
          "field": "Volume_km3",
          "type": "quantitative",
          "scale": {"range": [100, 5000]},
          "title": "Volume (km³)"
        },
        "color": { "field": "CategoryGroup" },
        "opacity": {
          "condition": {"param": "highlight", "value": 1},
          "value": 0.4
        },
        "tooltip": [
          {"field": "Category"},
          {"field": "Volume_km3"},
          {"field": "Percent_Global_Freshwater"}
        ]
      }
    },

    {
      "title": "100% Stacked Bar — Freshwater Composition",
      "mark": "bar",
      "height": 80,
      "transform": [
        { "filter": "datum.CategoryGroup === 'Fresh Water'" }
      ],
      "encoding": {
        "x": {
          "field": "ProportionOfFreshwater",
          "type": "quantitative",
          "stack": "normalize",
          "title": "% of Freshwater"
        },
        "color": {
          "field": "Category",
          "type": "nominal",
          "legend": {"title": "Freshwater Categories"}
        },
        "tooltip": [
          {"field": "Category"},
          {"field": "Volume_km3"},
          {"field": "Percent_Global_Freshwater"}
        ]
      }
    }
  ]
}
