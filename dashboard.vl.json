{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Earth's Freshwater & Biological Water Distribution",

  "data": { "url": "water_cleaned.csv" },

  "params": [
    {
      "name": "viewFilter",
      "value": "FreshwaterOnly",
      "bind": {
        "input": "select",
        "options": ["FreshwaterOnly", "FreshwaterAndBiological"],
        "labels": ["Freshwater Only", "Freshwater + Biological"]
      }
    },
    {
      "name": "scaleType",
      "value": "linear",
      "bind": {
        "input": "select",
        "options": ["linear", "log"],
        "labels": ["Linear Scale", "Log Scale"]
      }
    },
    {
      "name": "highlight",
      "select": {"type": "point", "fields": ["Category"]},
      "bind": "legend"
    }
  ],

  "vconcat": [
    {
      "hconcat": [
        {
          "title": "Freshwater Comparison (Linear / Log)",
          "transform": [
            { "filter": "datum.CategoryGroup === 'Fresh Water'" }
          ],
          "mark": "bar",
          "encoding": {
            "y": {
              "field": "Category",
              "type": "nominal",
              "sort": "-x",
              "axis": {"title": null}
            },
            "x": {
              "field": "Volume_km3",
              "type": "quantitative",
              "scale": {"type": {"expr": "scaleType"}},
              "title": "Volume (km³)"
            },
            "color": {
              "field": "CategoryGroup",
              "type": "nominal",
              "scale": {"scheme": "tableau10"},
              "title": "Group"
            },
            "opacity": {
              "condition": {"param": "highlight", "value": 1},
              "value": 0.4
            },
            "tooltip": [
              {"field": "Category"},
              {"field": "Volume_km3", "title": "Volume (km³)"},
              {"field": "Percent_Global_Freshwater", "title": "% of Global Freshwater"}
            ]
          }
        },
        {
          "title": "Freshwater Composition (100% stacked)",
          "transform": [
            { "filter": "datum.CategoryGroup === 'Fresh Water'" }
          ],
          "mark": "bar",
          "width": 250,
          "encoding": {
            "x": {
              "field": "Percent_Global_Freshwater",
              "type": "quantitative",
              "stack": "normalize",
              "title": "Proportion of Freshwater"
            },
            "color": {
              "field": "Category",
              "type": "nominal",
              "scale": {"scheme": "tableau10"}
            },
            "tooltip": [
              {"field": "Category"},
              {"field": "Percent_Global_Freshwater", "title": "% of Global Freshwater"}
            ]
          }
        }
      ]
    },
    {
      "title": "Bubble Chart — Freshwater + Biological Water",
      "height": 300,
      "mark": {"type": "circle", "opacity": 0.75},
      "transform": [
        {
          "filter": "viewFilter === 'FreshwaterOnly' ? datum.CategoryGroup === 'Fresh Water' : true"
        }
      ],
      "encoding": {
        "x": {
          "field": "Category",
          "type": "nominal",
          "axis": {"labelAngle": -40}
        },
        "y": {"value": 0},
        "size": {
          "field": "Volume_km3",
          "type": "quantitative",
          "scale": {"range": [100, 5000]},
          "title": "Volume (km³)"
        },
        "color": {
          "field": "CategoryGroup",
          "type": "nominal",
          "scale": {"scheme": "tableau10"},
          "title": "Group"
        },
        "opacity": {
          "condition": {"param": "highlight", "value": 1},
          "value": 0.4
        },
        "tooltip": [
          {"field": "Category"},
          {"field": "CategoryGroup"},
          {"field": "Volume_km3", "title": "Volume (km³)"},
          {"field": "Percent_Global_Freshwater", "title": "% of Global Freshwater"}
        ]
      }
    }
  ]
}
